\chapter{Roadmap}

\section{External libraries}

\subsection{Clostrophilia}

We introduced symbols such as x+1, x-1, and x\^\ to indicate different
``refinement'', but we can eliminate those if we use the new renaming
feature in the bootstrapping procedure.  That way, the Clostrophilia
code looks more ``natural''.  We do need to verify that no two systems
contain both symbol x and one of the variants simultaneously.  We can
then eliminate comments about refinement.

The documentation is embryonic and needs to be improved.

\subsection{Common macros}

Currently, the repository ``Common-macros'' contains two systems,
namely \texttt{common-macros} and \texttt{common-macro-definitions}.
We intended for \texttt{common-macros} to contain standard macros in
the form of AST transformations, but this turned out to be harder than
we had expected, simply because the code for such a transformation
because very ugly.  So we created the system
\texttt{common-macro-definitions} to contain standard macros in the
traditional way, using DEFMACRO forms.  Only
\texttt{common-macro-definitions} is currently used, and
\texttt{common-macros} is incomplete.

We want to remove the system \texttt{common-macros} from this
repository, rename it, and put it in a separate repository, say
\texttt{common-ast-macro-transformations} or something like that.  We
would have liked to rename \texttt{common-macro-definitions} to
\texttt{common-macros}, but it is already used by others, and we don't
want to force them to change their code.

\subsection{Common boot}

The essence of the repository ``Common-boot'' contains methods on
\texttt{architecture.builder-protocol:finish-node}.  Such a method
takes an unfinished abstract syntax tree (AST), i.e., one that
contains unparsed slots, and recursively calls \texttt{convert-ast}
that uses the \texttt{builder} of \texttt{Iconoclast} to parse the
slots so that the result is a finished AST.

But this repository also contains:

\begin{itemize}
\item definitions of node classes of a graph in high-level
  intermediate representation (HIR),
\item code for converting an AST to HIR,
\item code for closure conversion of an AST,
\item an evaluator working on the AST level, and
\item and evaluator working on the HIR level.
\end{itemize}

We think that this repository could be split up into several different
ones, given that some clients will not be interested in all this
functionality.  In particular, we have already ``extracted'' the
definitions of the HIR graph into the repository ``Hirundine''.  The
AST evaluator is no longer used by \sysname{}, but it could be
interesting for some other clients.  The HIR evaluator would be
extracted either to Hirundine or to a separate repository.

Each of the evaluators contains a fairly complete test suite that
should follow the corresponding evaluator to its new repository.

\subsection{Hirundine}

\subsection{Ecclesia}

\section{Bootstrapping}

\subsection{Replace cell sharing by renaming}

We used to use the macro \texttt{with-intercepted-function-cells} to
share cells between environments.  We may still need this macro in
order to introduce cells containing host functions, but for other
usages, we now have a better macro
\texttt{with-intercepted-function-names} that make it much more
obvious what functions call functions in other environments.  We
should apply this new macro to various Clostrophilia subsystems to
avoid funny symbol names.

\subsection{Maybe use more than one final environment}

The current idea is to make environment number 4 the ``final''
environment to be used as a model for the one in the final system.
But we have already suggested the use of several environments in the
final system, like a separate environment for each nontrivial
subsystem, like the compiler.  But there might already be some such
nontrivial subsystems that could be put in separate environments.  For
that to be a useful thing to do, the subsystem should contain a
significant amount of code, but supply very few entry points for
general use, like the compiler with \texttt{compile},
\texttt{compile-file}, and \texttt{eval}.  One such existing system
would be \texttt{ctype} that supplies only \texttt{typep} and
\texttt{subtypep}. 
