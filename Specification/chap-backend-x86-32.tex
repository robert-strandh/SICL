\chapter{x86-32}
\label{chap-backend-x86}

We are in the process of removing this chapter.  Some of the
information here will be transferred to
\refChap{chapter-backend-x86-64}, perhaps with modifications.

\section{Argument parsing}

By \emph{argument parsing}, we mean the process of analyzing the
arguments that were passed to a function, and using those arguments to
initialize variables corresponding to the names of the parameters of
that function.

Because of the presence of \emph{optional arguments} and \emph{keyword
  arguments} that arbitrary forms to evaluate, argument parsing is a
fairly complicated process.  The process is further complicated by the
fact that some of the parameters of the function might be
\emph{special variables} rather than \emph{lexical variables}.
However, the evaluation of default forms and the binding of special
variables is handled by code in the body of the function.  This code
is generated by the \cleavir{} compiler framework.

Most of the time, there are lexical variables and temporaries that are
not closed over.  Such variables need not be allocated in a level of
the lexical runtime environment, but can be allocated on the stack.
In this case, the place on the stack that these variables will occupy
overlaps with the place that the initial arguments are passed.  For
that reason, the arguments are first moved, leaving a hole in the
stack frame corresponding to the number of lexical variables and
temporaries that are not closed over.  Then, in each step, argument
parsing will either initialize one of these variables, or one of the
variables in the level of the lexical runtime environment.  Finally,
the arguments are removed from the stack, leaving only the lexical
variables and temporaries that are not closed over.  However, things
are complicated by the fact that as part of the argument-parsing
process, entries for dynamic variables may have been created.
Removing the arguments, then, consists of moving those entries to
clobber the arguments on the stack, and adjusting the dynamic
environment word to reflect this move.

As a special case of the scenario in the previous paragraph,
\emph{all} lexical variables and temporaries can be allocated on the
stack.  Then, no level of the lexical runtime environment will be
created at all, and the hole in the stack frame will be big enough to
hold all such variables.

Also as a special case of the scenario in that same paragraph, it is
common that some \emph{prefix} of the parameters of the function
contains variables that are not closed over.  The variables in this
prefix are already in their ultimate places, so only the remaining
arguments need to be moved.

When a function takes only required parameters and none of those
parameters are closed over, then the argument-parsing process is
reduced to \emph{nothing}, and all that needs to be done upon function
entry is to allocate space in the stack frame for temporaries.

